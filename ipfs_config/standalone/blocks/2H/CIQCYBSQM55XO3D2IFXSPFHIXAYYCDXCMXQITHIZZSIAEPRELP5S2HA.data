
›	“	// Copyright 2012 The Go Authors. All rights reserved.
// Use of this source code is governed by a BSD-style
// license that can be found in the LICENSE file.

// +build windows

// func servicemain(argc uint32, argv **uint16)
TEXT Â·servicemain(SB),7,$0
	MOVL	argc+0(FP), AX
	MOVL	AX, Â·sArgc(SB)
	MOVL	argv+4(FP), AX
	MOVL	AX, Â·sArgv(SB)

	PUSHL	BP
	PUSHL	BX
	PUSHL	SI
	PUSHL	DI

	SUBL	$12, SP

	MOVL	Â·sName(SB), AX
	MOVL	AX, (SP)
	MOVL	$Â·servicectlhandler(SB), AX
	MOVL	AX, 4(SP)
	MOVL	Â·cRegisterServiceCtrlHandlerW(SB), AX
	MOVL	SP, BP
	CALL	AX
	MOVL	BP, SP
	CMPL	AX, $0
	JE	exit
	MOVL	AX, Â·ssHandle(SB)

	MOVL	Â·goWaitsH(SB), AX
	MOVL	AX, (SP)
	MOVL	Â·cSetEvent(SB), AX
	MOVL	SP, BP
	CALL	AX
	MOVL	BP, SP

	MOVL	Â·cWaitsH(SB), AX
	MOVL	AX, (SP)
	MOVL	$-1, AX
	MOVL	AX, 4(SP)
	MOVL	Â·cWaitForSingleObject(SB), AX
	MOVL	SP, BP
	CALL	AX
	MOVL	BP, SP

exit:
	ADDL	$12, SP

	POPL	DI
	POPL	SI
	POPL	BX
	POPL	BP

	MOVL	0(SP), CX
	ADDL	$12, SP
	JMP	CX

// I do not know why, but this seems to be the only way to call
// ctlHandlerProc on Windows 7.

// func servicectlhandler(ctl uint32) uintptr
TEXT Â·servicectlhandler(SB),7,$0
	MOVL	Â·ctlHandlerProc(SB), CX
	JMP	CX
“	